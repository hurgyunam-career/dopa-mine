# Use Cases

핵심 사용자 흐름과 실패/예외 시나리오를 정의합니다.

## 프로토타입 개발 원칙 (UI 우선)
- 현재 단계에서는 본 문서의 유스케이스를 기준으로 화면 구조/문구/전환 흐름(UI)만 우선 구현한다.
- 실제 기능(데이터 저장, 소셜 인증, 히스토리 조회, 복구/지급 로직)은 추후 구현 범위로 분리한다.
- 사용자의 주요 액션은 데모 목적의 미리보기/안내 메시지로 처리할 수 있다.

## UC-01: 즉시 운동 진입
- 목적: 사용자가 고민 없이 바로 운동을 시작하게 한다.
- 액터: 사용자
- 사전조건: 홈 화면 진입 상태, 운동 목록 표시 완료
- 기본 흐름:
  1. 사용자가 5개 운동 종목 중 하나를 선택한다.
  2. `운동 시작` 버튼이 활성화된다.
  3. 버튼 탭 시 선택 종목의 운동 진행 화면으로 이동한다.
- 예외/실패:
  - 종목 미선택 상태에서는 `운동 시작` 버튼 비활성 유지
  - 종목 로딩 실패 시 재시도 UI 제공
- 완료조건: 운동 진행 화면으로 정상 전환된다.

## UC-02: 데이터 수집 및 세션 완료
- 목적: 운동 수행 데이터를 누락 없이 저장한다.
- 액터: 사용자
- 사전조건: 운동 진행 화면 진입, 운동 시작 상태
- 기본 흐름:
  1. 시간(타이머)과 횟수 데이터를 수집한다.
  2. 사용자가 `운동 완료`를 탭한다.
  3. 세션(`Session`) 데이터를 저장소로 전송한다.
  4. 저장 성공 시 리포트 화면으로 이동한다.
  5. 포인트 지급 안내를 사용자에게 노출한다.
- 예외/실패:
  - 저장 실패(네트워크/서버): 에러 메시지와 재시도 액션 제공
  - 중복 완료 요청: 첫 요청만 유효 처리하고 이후 요청은 무시
  - 타이머 0초 상태: 완료 전 안내 메시지 노출(정책에 따라 차단 또는 경고)
  - 횟수 음수 입력: 입력 불가
- 완료조건: 세션이 단일 완료 상태로 저장되고 리포트가 노출된다.

## UC-03: 세션 중단 및 복귀
- 목적: 사용자가 앱 상태 변화 중에도 진행 중 세션을 잃지 않게 한다.
- 액터: 사용자
- 사전조건: 세션 진행 중
- 기본 흐름:
  1. 사용자가 화면 이탈 또는 앱 백그라운드 전환을 수행한다.
  2. 앱이 현재 세션 상태(시간/횟수)를 보존한다.
  3. 복귀 시 이전 세션 상태를 복원한다.
- 예외/실패:
  - 상태 복원 실패 시 마지막 저장 시점 기준으로 복구 시도
  - 복구 불가 시 세션 재시작 안내 제공
- 완료조건: 기록 손실 없이 운동을 이어서 완료할 수 있다.

### UC-03-A: 백그라운드 복귀 정책
- 트리거: 앱이 `inactive/paused`로 전환될 때
- 정책:
  1. 진행 중 세션 스냅샷(`exerciseId`, 경과 시간, `repetitionCount`, 저장 시각)을 로컬 저장소에 즉시 저장한다.
  2. 앱이 `resumed`되면 로컬 스냅샷을 우선 복원하고 UI를 직전 상태로 동기화한다.
  3. 복원 성공 시 사용자에게 `이전 세션을 복구했습니다` 메시지를 1회 노출한다.
- 실패 처리:
  - 스냅샷 파싱/로드 실패 시 스냅샷을 폐기하고 새 세션 시작을 유도한다.
  - 24시간 이상 경과한 스냅샷은 자동 만료 처리한다.

### UC-03-B: 앱 종료(프로세스 종료) 복구 정책
- 트리거: 사용자가 앱을 강제 종료하거나 OS가 프로세스를 종료할 때
- 정책:
  1. 다음 앱 실행 시 시작 단계에서 미완료 세션 스냅샷 존재 여부를 조회한다.
  2. 스냅샷이 유효하면 `복구하기/새로 시작` 선택지를 제공한다.
  3. 사용자가 복구를 선택하면 스냅샷으로 세션을 복원하고 타이머/횟수를 이어서 진행한다.
  4. 사용자가 새로 시작을 선택하면 기존 스냅샷을 폐기하고 신규 세션을 생성한다.
- 실패 처리:
  - 스냅샷 조회 실패 시 오류 로그를 남기고 신규 세션 시작으로 폴백한다.

### 구현 기준 연결
- 기준 코드 위치: `app_flutter/lib/providers/workout_provider.dart`
- 현재 상태: 세션 완료 저장(`completeSession`)과 포인트 계산은 구현되어 있으나 앱 생명주기 기반 스냅샷 저장/복원은 미구현
- 구현 체크리스트:
  1. `WorkoutProvider`에 임시 세션 상태(`inProgressSession`) 모델을 추가한다.
  2. 앱 생명주기 이벤트(`paused/resumed`)에서 스냅샷 save/restore를 호출한다.
  3. 로컬 저장소(예: `SharedPreferences` 또는 `hydrated` 계층) 어댑터를 도입한다.
  4. 복원 성공/실패 UX 메시지 정책을 `UC-03-A/B`와 동일하게 맞춘다.
  5. 테스트에서 백그라운드 복귀/앱 재실행 복원 시나리오를 각각 검증한다.

## UC-04: 소셜 로그인
- 목적: 사용자가 이메일/비밀번호 입력 없이 빠르게 회원 인증을 완료하게 한다.
- 액터: 사용자, 소셜 인증 제공자
- 지원 범위(1차 릴리즈): Google 전용 (`docs/todo/02_social_login.md` 참조)
- 사전조건: 로그인 화면 진입, 네트워크 연결 가능 상태
- 기본 흐름:
  1. 사용자가 소셜 로그인 버튼을 탭한다.
  2. 앱이 제공자 인증 화면 또는 계정 선택 UI를 호출한다.
  3. 사용자가 인증/권한 동의를 완료한다.
  4. 앱이 인증 토큰을 백엔드로 전달해 사용자 세션을 발급받는다.
  5. 로그인 성공 후 홈 화면으로 이동하고 사용자 프로필 상태를 동기화한다.
- 예외/실패:
  - 사용자가 인증 중 취소: 로그인 화면 유지 및 취소 안내 메시지 노출
  - 인증 토큰 검증 실패: 재시도 버튼과 일반 로그인 대체 경로 제공
  - 네트워크 오류: 재시도 액션 및 오프라인 안내 표시
  - 신규 사용자 미완료 프로필: 추가 정보 입력 플로우로 분기
- 완료조건: 유효한 사용자 세션이 생성되고 홈 화면 접근이 가능하다.

## UC-05: 운동 히스토리 조회
- 목적: 사용자가 과거 운동 기록을 확인해 성과를 추적하게 한다.
- 액터: 사용자
- 사전조건: 로그인 완료, 최소 1개 이상 저장된 세션 존재(없어도 빈 상태 조회 가능)
- 기본 흐름:
  1. 사용자가 `히스토리` 탭(또는 메뉴)으로 이동한다.
  2. 앱이 기간/정렬 기본값으로 세션 목록을 조회한다.
  3. 목록에 운동 종목, 수행 시간, 횟수, 완료 시각, 획득 포인트를 표시한다.
  4. 사용자가 특정 항목을 선택하면 세션 상세(세트/메모/기록)를 확인한다.
  5. 사용자가 기간 필터(주간/월간/사용자 지정) 또는 정렬 조건을 변경한다.
  6. 앱이 조건에 맞는 히스토리 목록과 합계 지표를 갱신한다.
- 예외/실패:
  - 데이터 없음: `아직 기록이 없습니다` 빈 상태 화면과 운동 시작 CTA 제공
  - 조회 실패(네트워크/서버): 오류 메시지 및 재시도 버튼 노출
  - 부분 로딩 실패(상세만 실패): 목록은 유지하고 상세 영역만 재조회 허용
  - 중복 요청: 마지막 요청 기준으로만 화면 상태를 갱신한다.
- 완료조건: 사용자가 원하는 조건으로 히스토리를 조회하고 세션 상세를 확인할 수 있다.

## 변경 이력
| 날짜 | 변경 요약 | 작성자 |
| --- | --- | --- |
| 2026-02-27 | UC-04 지원 범위(1차: Google 전용) 명시 | @cursor-agent |
| 2026-02-24 | UI 우선 프로토타입 개발 원칙 섹션 추가 | @owner |
| 2026-02-24 | `UC-04` 소셜 로그인, `UC-05` 운동 히스토리 조회 유스케이스 추가 | @owner |
| 2026-02-24 | `UC-03` 세션 복구 정책(백그라운드/앱 종료)과 구현 기준 연결 추가 | @owner |
| 2026-02-24 | 변경 이력 정책 섹션 도입 | @owner |
